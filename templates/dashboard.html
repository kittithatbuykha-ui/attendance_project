<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
    <nav class="bg-indigo-800 p-4 text-white shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏Å‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô </h1>
            <div class="space-x-4">
                <button onclick="showTab('attendance')" class="hover:underline">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</button>
                <button onclick="showTab('register')" class="hover:underline">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏´‡∏°‡πà</button>
                <a href="/" class="bg-indigo-600 px-3 py-1 rounded">‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡πÅ‡∏Å‡∏ô</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto mt-6 p-4">
        <div id="attendance-tab" class="tab-content">
            <div class="bg-white p-6 rounded-xl shadow">
                <h2 class="text-2xl font-bold mb-4">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-200 text-black">
                                <th class="p-3 border">‡∏£‡∏´‡∏±‡∏™</th>
                                <th class="p-3 border">‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th class="p-3 border">‡∏ä‡∏±‡πâ‡∏ô/‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
                                <th class="p-3 border">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th class="p-3 border">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in data %}
                            <tr class="text-black border-b text-center">
                                <td class="p-3 border">{{ row['‡∏£‡∏´‡∏±‡∏™'] }}</td>
                                <td class="p-3 border font-semibold text-left">{{ row['‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'] }}</td>
                                <td class="p-3 border">{{ row['‡∏ä‡∏±‡πâ‡∏ô/‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà'] }}</td>
                                <td class="p-3 border">{{ row['‡πÄ‡∏ß‡∏•‡∏≤'] }}</td>
                                <td class="p-3 border">
                                    <span class="px-2 py-1 rounded text-xs {{ 'bg-green-100 text-green-700' if row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] == '‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥' else 'bg-red-100 text-red-700' }}">
                                        {{ row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="register-tab" class="tab-content hidden">
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <div>
                    <h2 class="text-xl font-bold mb-4 text-indigo-800">1. ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h2>
                    <div class="relative bg-black rounded-lg overflow-hidden aspect-video border-4 border-gray-200">
                        <video id="reg-video" class="w-full h-full object-cover" autoplay playsinline></video>
                        <canvas id="reg-canvas" class="hidden" width="640" height="480"></canvas>
                    </div>
                    <p class="text-sm text-gray-500 mt-2 text-center">‡∏à‡∏±‡∏î‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏•‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á</p>
                </div>

                <div>
                    <h2 class="text-xl font-bold mb-4 text-indigo-800">2. ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                    <div class="space-y-4">
                        <input type="text" id="reg-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full border p-2 rounded text-black">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="text" id="reg-id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß" class="w-full border p-2 rounded text-black">
                            <input type="text" id="reg-grade" placeholder="‡∏ä‡∏±‡πâ‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏°.1)" class="w-full border p-2 rounded text-black">
                        </div>
                        <input type="number" id="reg-no" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà" class="w-full border p-2 rounded text-black">
                        
                        <button onclick="captureAndRegister()" class="w-full bg-green-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-green-500 shadow-lg mt-4">
                            üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('reg-video');
        const canvas = document.getElementById('reg-canvas');

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
            if(tabName === 'register') {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => { video.srcObject = stream; })
                    .catch(err => alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ"));
            }
        }

        async function captureAndRegister() {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
            const name = document.getElementById('reg-name').value;
            const student_id = document.getElementById('reg-id').value;
            const grade = document.getElementById('reg-grade').value;
            const no = document.getElementById('reg-no').value;

            if(!name || !student_id) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

            // ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å Video ‡∏•‡∏á Canvas
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            canvas.toBlob(async (blob) => {
                const formData = new FormData();
                formData.append('file', blob, 'student.jpg');
                formData.append('name', name);
                formData.append('student_id', student_id);
                formData.append('grade', grade);
                formData.append('no', no);

                const response = await fetch('/register', { method: 'POST', body: formData });
                const result = await response.json();

                if(result.status === 'success') {
                    alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å " + name + " ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
                    location.reload(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                }
            }, 'image/jpeg');
        }
    </script>
</body>
</html>
